<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ChafficPlugins - Download</title>
    <meta name="description" content="Download ChafficPlugins Minecraft server plugins.">
    <link rel="stylesheet" href="style/main.css">
    <link rel="icon" type="image/x-icon" href="img/favicon.ico">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4734982214094550" crossorigin="anonymous"></script>
</head>
<body>

<div class="bg-decoration"></div>

<main class="download-page">
    <div class="download-card">
        <!-- Icon -->
        <div class="download-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
        </div>

        <!-- Plugin info (filled by JS) -->
        <h1 class="download-title" id="downloadTitle">Preparing download&hellip;</h1>
        <span class="download-version" id="downloadVersion"></span>

        <!-- Progress bar -->
        <div class="download-progress">
            <div class="download-progress-bar" id="progressBar"></div>
        </div>
        <p class="download-status" id="downloadStatus">Please wait&hellip;</p>

        <!-- Action buttons -->
        <div class="download-actions">
            <button class="btn btn-primary" id="downloadButton" disabled onclick="download()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                <span id="downloadButtonText">Wait 5s</span>
            </button>
            <a class="btn btn-secondary" href="https://chafficplugins.github.io">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Back to ChafficPlugins
            </a>
        </div>

        <!-- Partner -->
        <div class="download-partner">
            <p class="download-partner-label">Recommended Server Hosting</p>
            <a class="download-partner-banner" id="partnerBanner" href="#" target="_blank" rel="noopener noreferrer">
                <div class="download-partner-top">
                    <svg class="download-partner-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                    <span class="download-partner-name" id="partnerName"></span>
                </div>
                <div class="download-partner-offer" id="partnerOffer"></div>
                <div class="download-partner-cta">
                    <span class="download-partner-cta-text">Get Started</span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd"/></svg>
                </div>
            </a>
        </div>
    </div>

    <!-- Footer link -->
    <div class="download-footer">
        <a class="download-footer-link" href="https://felixbeinssen.net/imprint" target="_blank" rel="noopener noreferrer">Imprint</a>
    </div>
</main>

<script>
    // Parse URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const plugin = urlParams.get('plugin');
    const version = urlParams.get('version');

    // Populate page content
    if (plugin && version) {
        document.getElementById('downloadTitle').textContent = plugin;
        document.getElementById('downloadVersion').textContent = 'v' + version;
        document.title = plugin + ' v' + version + ' - ChafficPlugins Download';
    }

    // Countdown with progress bar
    var countdown = 5;
    var progressBar = document.getElementById('progressBar');
    var statusEl = document.getElementById('downloadStatus');
    var btnText = document.getElementById('downloadButtonText');
    var btn = document.getElementById('downloadButton');

    for (var i = 0; i <= countdown; i++) {
        (function(step) {
            setTimeout(function() {
                var progress = (step / countdown) * 100;
                progressBar.style.width = progress + '%';

                if (step < countdown) {
                    var remaining = countdown - step;
                    statusEl.textContent = 'Your download will be ready in ' + remaining + ' second' + (remaining !== 1 ? 's' : '') + '.';
                    btnText.textContent = 'Wait ' + remaining + 's';
                } else {
                    statusEl.textContent = 'Your file is ready.';
                    btnText.textContent = 'Download ' + plugin + '-v' + version + '.jar';
                    btn.disabled = false;
                }
            }, 1000 * step);
        })(i);
    }

    // Affiliate partner rotation
    var partners = [
        {
            name: 'Shockbyte',
            url: 'https://shockbyte.com/billing/aff.php?aff=4416',
            offer: 'Use code <span class="download-partner-code">LAUNCH</span> for 25% off'
        },
        {
            name: 'WiseHosting',
            url: 'https://wisehosting.com/aff.php?aff=3248',
            offer: 'Reliable Minecraft server hosting'
        }
    ];
    var partner = partners[Math.floor(Math.random() * partners.length)];
    document.getElementById('partnerBanner').href = partner.url;
    document.getElementById('partnerName').textContent = partner.name;
    document.getElementById('partnerOffer').innerHTML = partner.offer;

    // GitHub release download
    function download() {
        window.open(
            'https://github.com/ChafficPlugins/' + plugin +
            '/releases/download/v' + version + '/' +
            plugin + '-v' + version + '.jar'
        );
    }
</script>

</body>
</html>
